<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Gift Stacker</title>
    <!-- Google Fonts: Chewy (Headers) & Outfit (UI) -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Chewy&family=Outfit:wght@300;400;500;700&display=swap"
        rel="stylesheet">
    <script>
        // NUCLEAR OPTION: Global Enter Key Kill Switch
        // Run immediately before body loads
        window.addEventListener('keydown', function (e) {
            if (e.key === 'Enter' || e.code === 'Enter' || e.keyCode === 13) {
                e.preventDefault();
                e.stopPropagation();
                e.stopImmediatePropagation();
                console.log("Enter key blocked by Nuclear Option");
                return false;
            }
        }, true);
        window.addEventListener('keypress', function (e) {
            if (e.key === 'Enter' || e.code === 'Enter' || e.keyCode === 13) {
                e.preventDefault();
                e.stopPropagation();
                e.stopImmediatePropagation();
                return false;
            }
        }, true);
        window.addEventListener('keyup', function (e) {
            if (e.key === 'Enter' || e.code === 'Enter' || e.keyCode === 13) {
                e.preventDefault();
                e.stopPropagation();
                e.stopImmediatePropagation();
                return false;
            }
        }, true);
    </script>
    <link rel="stylesheet" href="style.css">
    <link rel="icon" href="logo.png" type="image/png">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/matter-js/0.19.0/matter.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
</head>

<body>
    <div id="christmas-bg">
        <div id="bg-tree"></div>
    </div>
    <div id="ui-layer">
        <div id="score-container">
            <div class="gift-score-box">
                <div class="lid">
                    <span class="score-label">Score</span>
                </div>
                <div class="box-body">
                    <span id="score" class="score-value">0</span>
                </div>
            </div>
            <!-- High score move to end only -->
            <div id="lives-container" class="scores-sub-display hidden">
                <span>Lives:</span>
                <div id="lives-icons" style="display:flex; gap:2px;"></div>
            </div>
        </div>

        <div id="toast" class="hidden"></div>
        <div id="debug-stats" class="hidden"></div>

        <div id="timer-container" class="hidden">
            <div id="timer-bar"></div>
        </div>

        <button id="menu-btn" class="icon-btn">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                <path d="M6 19h4V5H6v14zm8-14v14h4V5h-4z" />
            </svg>
        </button>

        <!-- Pause Menu Modal -->
        <div id="pause-menu-modal" class="modal hidden">
            <h2>Game Paused</h2>
            <button id="resume-btn">Resume</button>

            <div class="checkbox-row inline-block" style="justify-content: center; margin: 10px 0;">
                <input type="checkbox" id="pause-sound-enabled">
                <label for="pause-sound-enabled">Sound Effects</label>
            </div>

            <button id="quit-game-btn" class="secondary-btn">Quit Game</button>
            <button id="release-notes-btn" class="text-link">â„¹ï¸ Gift Stacker v0.7.0</button>
        </div>

        <!-- Quit Confirmation Modal -->
        <div id="quit-confirm-modal" class="modal hidden">
            <h3>Really Quit?</h3>
            <p>Current game progress will be lost.</p>
            <div class="modal-actions">
                <button id="confirm-quit-btn" class="primary-btn">Yes, Quit</button>
                <button id="cancel-quit-btn" class="secondary-btn">Cancel</button>
            </div>
        </div>

        <!-- Reset Score Confirmation Modal -->
        <div id="reset-score-modal" class="modal hidden">
            <h3>Reset High Score?</h3>
            <div class="modal-actions">
                <button id="confirm-reset-btn" class="danger-btn">Reset</button>
                <button id="cancel-reset-btn" class="secondary-btn">Cancel</button>
            </div>
        </div>

        <!-- Release Notes Modal -->
        <div id="release-notes-modal" class="modal hidden">
            <h2>Release Notes v0.7.0</h2>
            <div class="scroll-content">
                <h3>v0.7.0 - The Shiny Update âœ¨</h3>
                <ul>
                    <li>âœ¨ <strong>Visuals:</strong> Splash screen makeover & cleaner UI style.</li>
                    <li>ğŸ“± <strong>Mobile:</strong> Better layouts for Shop and Leaderboard.</li>
                    <li>ğŸ› <strong>Fixes:</strong> Squashed bugs with Pause button and overlapping text.</li>
                </ul>
                <hr>
                <h3>v0.6.5 - The "Zombie Slayer" Update ğŸ§Ÿâ€â™‚ï¸</h3>
                <ul>
                    <li>ğŸ›‘ <strong>Critical Fix:</strong> Eliminated the "Zombie Game" bug that caused games to
                        auto-restart.</li>
                    <li>ğŸ¨ <strong>Polish:</strong> Improved Gift Shop card spacing and layout.</li>
                    <li>ğŸª <strong>Visuals:</strong> Added cookie rewards to Game Over screen.</li>
                </ul>
                <hr>
                <h3>v0.6 - The Gratification Update ğŸ</h3>
                <ul>
                    <li>ğŸ <strong>Gift Shop:</strong> Spend your hard-earned cookies on new themes!</li>
                    <li>ğŸ† <strong>Leaderboard:</strong> Compete globally with the new Top 10 High Score board.</li>
                </ul>
                <hr>
                <h3>v0.5.5 - The Polish Update</h3>
                <ul>
                    <li>ğŸ› <strong>Fixes:</strong> Resolved Splash Screen bugs and aligned Home button.</li>
                    <li>ğŸ‘† <strong>Controls:</strong> Improved pause responsiveness.</li>
                    <li>ğŸ“ <strong>Visuals:</strong> Fixed alignment of the Home button icon.</li>
                </ul>
                <hr>
                <h3>v0.5.0 - The "Polish" Update</h3>
                <ul>
                    <li>ğŸš€ <strong>Major Milestone:</strong> Complete visual and physics overhaul.</li>
                    <li>ğŸ¨ <strong>Visuals:</strong> New 'Chewy' & 'Outfit' typography, refined layout, and animations.
                    </li>
                    <li>ğŸ”¢ <strong>Odometer Scoring:</strong> Slick new score transitions (up/down).</li>
                    <li>âš–ï¸ <strong>Physics 2.0:</strong> "Anti-Rubber" tuning for precise stacking.</li>
                </ul>
                <hr>
                <h3>v0.4.x - Early Access</h3>
                <ul>
                    <li>ğŸ—ï¸ <strong>Physics:</strong> "Anti-Rubber" tuning for precise stacking.</li>
                    <li>ğŸ¨ <strong>Visuals:</strong> Dark Mode, Snow effects, and more.</li>
                </ul>
            </div>
            <button id="close-notes-btn">Close</button>
        </div>


        <div id="start-screen">
            <img src="logo.png" id="game-logo" alt="Gift Stacker Logo">
            <h1>Gift Stacker</h1>
            <h2>Stack the gifts as high as you can!</h2>
            <!-- High Score Removed -->
            <div class="start-actions">
                <button id="start-btn">Start Game</button>
                <div class="sub-actions">
                    <button id="shop-btn" class="icon-btn-settings" title="Shop">
                        ğŸ›ï¸
                    </button>
                    <button id="leaderboard-btn" class="icon-btn-settings" title="Leaderboard">
                        ğŸ†
                    </button>
                    <button id="settings-btn" class="icon-btn-settings" title="Settings">
                        <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32"
                            viewBox="0 0 24 24"><!-- Icon from Material Symbols by Google - https://github.com/google/material-design-icons/blob/master/LICENSE -->
                            <path fill="currentColor"
                                d="M10.825 22q-.675 0-1.162-.45t-.588-1.1L8.85 18.8q-.325-.125-.612-.3t-.563-.375l-1.55.65q-.625.275-1.25.05t-.975-.8l-1.175-2.05q-.35-.575-.2-1.225t.675-1.075l1.325-1Q4.5 12.5 4.5 12.337v-.675q0-.162.025-.337l-1.325-1Q2.675 9.9 2.525 9.25t.2-1.225L3.9 5.975q.35-.575.975-.8t1.25.05l1.55.65q.275-.2.575-.375t.6-.3l.225-1.65q.1-.65.588-1.1T10.825 2h2.35q.675 0 1.163.45t.587 1.1l.225 1.65q.325.125.613.3t.562.375l1.55-.65q.625-.275 1.25-.05t.975.8l1.175 2.05q.35.575.2 1.225t-.675 1.075l-1.325 1q.025.175.025.338v.674q0 .163-.05.338l1.325 1q.525.425.675 1.075t-.2 1.225l-1.2 2.05q-.35.575-.975.8t-1.25-.05l-1.5-.65q-.275.2-.575.375t-.6.3l-.225 1.65q-.1.65-.587 1.1t-1.163.45zM11 20h1.975l.35-2.65q.775-.2 1.438-.587t1.212-.938l2.475 1.025l.975-1.7l-2.15-1.625q.125-.35.175-.737T17.5 12t-.05-.787t-.175-.738l2.15-1.625l-.975-1.7l-2.475 1.05q-.55-.575-1.212-.962t-1.438-.588L13 4h-1.975l-.35 2.65q-.775.2-1.437.588t-1.213.937L5.55 7.15l-.975 1.7l2.15 1.6q-.125.375-.175.75t-.05.8q0 .4.05.775t.175.75l-2.15 1.625l.975 1.7l2.475-1.05q.55.575 1.213.963t1.437.587zm1.05-4.5q1.45 0 2.475-1.025T15.55 12t-1.025-2.475T12.05 8.5q-1.475 0-2.487 1.025T8.55 12t1.013 2.475T12.05 15.5M12 12" />
                        </svg>
                    </button>
                </div>
            </div>

            <div class="version-info">v0.7.0 by Sean O</div>
        </div>

        <!-- Shop Modal -->
        <div id="shop-modal" class="modal hidden">
            <h2>ğŸ Gift Shop</h2>
            <div class="shop-header">
                <span>ğŸª You have <span id="shop-bank-display">0</span> cookies</span>
            </div>
            <div id="shop-items-container">
                <!-- Populated by JS -->
            </div>
            <button id="close-shop-btn">Close</button>
        </div>

        <div id="fps-counter">60</div>
        <div id="toast" class="hidden"></div>

        <div id="settings-modal" class="modal hidden">
            <h2>Settings</h2>
            <div class="setting-row">
                <label>Difficulty:</label>
                <div class="toggle-group">
                    <button id="diff-easy" class="toggle-btn">Easy</button>
                    <button id="diff-standard" class="toggle-btn active">Standard</button>
                    <button id="diff-hard" class="toggle-btn">Hard</button>
                </div>
            </div>
            <div class="setting-row">
                <label>Slide Speed: <span id="slide-speed-val">1.0x</span></label>
                <input type="range" id="slide-speed" min="0.5" max="2.0" step="0.1" value="1.0">
            </div>
            <div class="setting-row">
                <label>Drop Speed: <span id="drop-speed-val">1.0x</span></label>
                <input type="range" id="drop-speed" min="0.5" max="2.0" step="0.1" value="1.0">
            </div>
            <div class="setting-row">
                <label>Bounciness: <span id="bounce-val">Normal</span></label>
                <input type="range" id="bounce" min="0" max="0.5" step="0.05" value="0.5">
            </div>
            <div class="setting-row checkbox-row">
                <input type="checkbox" id="sound-enabled" checked>
                <label for="sound-enabled">Sound Effects</label>
            </div>
            <div class="setting-row checkbox-row">
                <input type="checkbox" id="random-sizes">
                <label for="random-sizes">Randomize Gift Box Sizes</label>
            </div>
            <div class="setting-row">
                <label>Theme:</label>
                <div class="toggle-group">
                    <button id="theme-christmas" class="toggle-btn active">Christmas</button>
                    <button id="theme-standard" class="toggle-btn">Standard</button>
                </div>
            </div>

            <button id="close-settings-btn">Save</button>
        </div>

        <div id="game-over-screen" class="hidden">
            <h1>Game Over</h1>
            <div id="new-record-msg" class="hidden new-record">New High Score!</div>
            <div class="gift-score-box large">
                <div class="lid">
                    <span class="score-label">Score</span>
                </div>
                <div class="box-body">
                    <span id="final-score" class="score-value">0</span>
                </div>
            </div>
            <div id="game-over-cookie-msg"
                style="margin-top: -15px; margin-bottom: 20px; font-weight: 900; font-size: 1.3rem; color: #4caf50;">
            </div>
            <div class="actions">
                <button id="home-btn" class="icon-btn-small" title="Home">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                        stroke-linecap="round" stroke-linejoin="round">
                        <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>
                        <polyline points="9 22 9 12 15 12 15 22"></polyline>
                    </svg>
                </button>
                <button id="restart-btn">Play Again</button>
            </div>
            <div class="high-score-container">
                <p id="game-over-high-score">High Score: 0</p>
                <button id="reset-score-btn" class="reset-link-btn">Reset</button>
            </div>
        </div>
    </div>
    <div id="scene">
        <!-- Physics bodies will be mapped to DOM elements here -->
    </div>
    <!-- Firebase SDKs (Compat for simplicity) -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>

    <!-- Game Scripts -->
    <script src="firebase-config.js"></script>
    <script src="leaderboard.js"></script>
    <!-- Removed snowSystem.js (legacy) -->

    <!-- Leaderboard Modal -->
    <div id="leaderboard-modal" class="modal hidden">
        <h2>ğŸ† Top 10 Stackers</h2>

        <div id="leaderboard-container">
            <ul id="leaderboard-list">
                <!-- Populated by JS -->
                <li class="loading">Loading...</li>
            </ul>
        </div>

        <div class="leaderboard-controls">
            <button id="close-leaderboard-btn" class="btn">Close</button>
        </div>
    </div>

    <!-- Submit Score Modal -->
    <div id="submit-score-modal" class="modal hidden">
        <h2>ğŸ† New High Score!</h2>
        <p id="submit-score-msg">You scored <span id="submit-score-val">0</span>!</p>

        <input type="text" id="player-name-input" placeholder="Enter your name" maxlength="12">

        <div class="modal-buttons" style="display: flex; gap: 10px; justify-content: center; margin-top: 15px;">
            <button id="submit-score-btn" class="btn primary-btn">Submit</button>
            <button id="skip-submit-btn" class="secondary-btn">Skip</button>
        </div>
    </div>

    <script src="game.js"></script>
</body>

</html>